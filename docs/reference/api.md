# API Reference

Chronos exposes a REST API using FastAPI. The OpenAPI schema is available at `/openapi.json` and rendered via Swagger UI at `/docs`.

## Authentication

Chronos does not enforce authentication by default. Deployments should secure the API using a reverse proxy (e.g., OAuth 2.0 via Traefik, Kong, or API Umbrella) before exposing it to end users.

## Key Resources

### `/models`

- `GET /models` – list models (supports filtering via query parameters `status`, `entity_id`, `feature`).
- `POST /models` – create a model definition.

### `/models/{model_id}`

- `GET` – retrieve details, including training status and metrics.
- `PATCH` – update metadata or hyperparameters.
- `DELETE` – mark model as deleted and remove associated artefacts.

### `/models/{model_id}/training-jobs`

- `GET` – list training jobs for the model.
- `POST` – enqueue a new training job (`last_n` optional).

### `/models/{model_id}/training-jobs/{job_id}`

- `GET` – retrieve job status and metrics.
- `POST /predict` – run an on-demand forecast.
- `POST /prediction-toggle` – enable or disable recurring forecasts (Celery beat).
- `GET /predictions/history` – fetch prediction history from STH-Comet.

### `/devices`

- `GET` – list devices discovered via the IoT Agent.

### `/health`

- Returns system health, including dependencies (MongoDB, RabbitMQ, Redis).

### `/info`

- Returns build metadata, versions, git commit, and FIWARE endpoints.

## Error Handling

- Errors follow FastAPI default semantics with JSON responses (`detail` field).
- FIWARE gateway errors provide contextual `code`, `entity_id`, and original HTTP status.

## Webhooks & Subscriptions

- Chronos creates Orion subscriptions to notify external services when forecasts change.
- Notifications use NGSI legacy attribute format by default. NGSI-LD support is under development (see roadmap).

For exhaustive schema definitions, consult the autogenerated documentation in Swagger UI or the `openapi.json` artefact.
